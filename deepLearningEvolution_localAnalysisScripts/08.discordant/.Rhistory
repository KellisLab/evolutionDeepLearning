data <- read.csv("merged.discordant.overlaps.txt", header = FALSE, sep='\t')
library(Matrix)
library(grid)
library(pheatmap)
library(dplyr)
library(tidyr)
library(data.table)
library(RColorBrewer)
data <- read.csv("merged.discordant.overlaps.txt", header = FALSE, sep='\t')
data <- data[, c(1, 2, 3, 4, 12, 15)]
new_data <- data.frame(data[, 1], peakID = paste(data[, 2], data[, 3], data[, 4], sep = "."),
data[, c(5, 6)])
colnames(new_data) <- c("bioSample", "peakID", "log2FC", "minusLog10pValue")
new_data <- new_data[!duplicated(new_data[, c("bioSample", "peakID")]), ]
heatmap_data <- new_data %>%
select("bioSample", "peakID", "log2FC") %>%
pivot_wider(names_from="peakID", values_from="log2FC")
heatmap_data <- as.data.frame(heatmap_data)
rownames(heatmap_data) <- heatmap_data$bioSample
heatmap_data$bioSample <- NULL
heatmap_data[is.na(heatmap_data)] <- 0
#set up heatmap annotations
metadata <- read.csv("subsampledBiosamples.txt", header=TRUE, sep="\t")
annotation_row <- metadata[, c("Group", "Lifestage", "Type")]
rownames(annotation_row) <- metadata$Biosample
#set up heatmap annotations
metadata <- read.csv("subsampledBiosamples.txt", header=TRUE, sep="\t")
metadata
data <- read.csv("merged.discordant.overlaps.txt", header = FALSE, sep='\t')
data <- data[, c(1, 2, 3, 4, 12, 15)]
new_data <- data.frame(data[, 1], peakID = paste(data[, 2], data[, 3], data[, 4], sep = "."),
data[, c(5, 6)])
colnames(new_data) <- c("bioSample", "peakID", "log2FC", "minusLog10pValue")
new_data <- new_data[!duplicated(new_data[, c("bioSample", "peakID")]), ]
heatmap_data <- new_data %>%
select("bioSample", "peakID", "log2FC") %>%
pivot_wider(names_from="peakID", values_from="log2FC")
heatmap_data <- as.data.frame(heatmap_data)
rownames(heatmap_data) <- heatmap_data$bioSample
heatmap_data$bioSample <- NULL
heatmap_data[is.na(heatmap_data)] <- 0
#set up heatmap annotations
metadata <- read.csv("subsampledBiosamples.txt", header=TRUE, sep="\t")
annotation_row <- metadata[, c("Group", "Lifestage", "Type")]
rownames(annotation_row) <- metadata$Biosample
# Define custom annotation colors
# Group colors: generate colors for the number of unique groups
group_colors <- colorRampPalette(brewer.pal(12, "Paired"))(length(unique(annotation_row$Group)))
# Type colors
type_colors <- c(
"Cell Line" = "#1c3144",
"Tissue" = "#d00000",
"In Vitro Differentiated" = "#ffba08"
)
# Lifestage colors
lifestage_colors <- c(
"Cell Line" = "#219ebc",
"Developing" = "#FFD700",
"Adult" = "#8ecae6",
"Newborn" = "#fb8500"
)
# Map colors to annotation levels
annotation_colors <- list(
Group = setNames(group_colors, sort(unique(annotation_row$Group))),
Lifestage = lifestage_colors,
Type = type_colors
)
# Define a color scale for the heatmap
color_scale <- colorRampPalette(c("blue", "white", "red"))(100)
p_data <- new_data %>% select("bioSample", "peakID", "minusLog10pValue") %>%
pivot_wider(names_from="peakID", values_from="minusLog10pValue")
p_data <- as.data.frame(p_data)
rownames(p_data) <- p_data$bioSample
p_data$bioSample <- NULL
p_data[is.na(p_data)] <- 0
p_data[p_data > 2] <- NA
p_data[!is.na(p_data)] <- ""
p_data[is.na(p_data)] <- "*"
fc_data <- heatmap_data
fc_data[abs(fc_data) > 0.5] <- NA
fc_data[!is.na(fc_data)] <- ""
fc_data[is.na(fc_data)] <- "*"
sign_data <- p_data
sign_data <- ifelse(p_data == '*' & fc_data == '*', '*', '')
mask <- apply(sign_data == "*", 1, any)
sign_data <- sign_data[mask, ]
sign_mat <- as.matrix(sign_data)
heatmap_data <- heatmap_data[mask, ]
heatmap_mat <- as.matrix(heatmap_data)
annotation_row <- annotation_row[rownames(heatmap_mat), , drop = FALSE]
pheatmap(
mat = heatmap_mat,
annotation_row = annotation_row, # Row-level annotations for biosamples
annotation_colors = annotation_colors, # Custom annotation colors
display_numbers = sign_mat,
cluster_rows = TRUE, # Cluster rows (biosamples)
cluster_cols = TRUE, # Cluster columns (peaks)
show_rownames = TRUE, # Show biosample names (rows)
show_colnames = TRUE, # Suppress column names (peaks) for clarity
treeheight_col = 0, # Hide column clustering dendrogram height
angle_col = 45,
color = color_scale, # Define the heatmap color scale
fontsize_row = 4, # Font size for biosample names (rows)
fontsize_col = 5,
main = "Discordant Peaks by Biosample" # Title for the heatmap
)
# Transpose both the heatmap matrix and the sign matrix
heatmap_mat_t <- t(heatmap_mat)
sign_mat_t <- t(sign_mat)
# Update annotation to match new row orientation (columns are now rows)
annotation_col <- annotation_row  # rename for clarity
annotation_row <- NULL            # remove old row annotations
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = NA,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = FALSE,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = FALSE,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = FALSE,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = FALSE,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample
)
dev.off()
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
legend = FALSE,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample"
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Peaks by Biosample (Transposed)"
)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 6, height = 10)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
dev.off()
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 6, height = 10)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 10, height = 6)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 10, height = 4)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 8, height = 3)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
pdf("pdf/transposed.discordantPeaksHeatmap.pdf", width = 9, height = 4)
pheatmap(
mat = heatmap_mat_t,
annotation_col = annotation_col,  # now applies along biosamples (columns)
annotation_colors = annotation_colors,
display_numbers = sign_mat_t,
cluster_rows = TRUE,  # cluster peaks (now rows)
cluster_cols = TRUE,  # cluster biosamples (now columns)
show_rownames = TRUE,
show_colnames = TRUE,
treeheight_col = 0,
treeheight_row = 0,
angle_col = 45,
legend = FALSE,
annotation_legend = FALSE,
color = color_scale,
fontsize_row = 5,
fontsize_col = 4,
main = "Discordant Differentially Accessible Regions"
)
dev.off()
dim(heatmap_mat_t)
